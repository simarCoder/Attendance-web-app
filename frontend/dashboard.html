<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Dashboard | HR System</title>

    <!-- CSS -->
    <link rel="stylesheet" href="css/theme.css" />
    <link rel="stylesheet" href="css/layout.css" />
    <link rel="stylesheet" href="css/components.css" />
  </head>
  <body>
    <div class="dashboard-container">
      <!-- Sidebar -->
      <aside class="sidebar">
        <div class="sidebar-header">HR Manager</div>
        <nav class="sidebar-nav">
          <div
            class="nav-item active"
            onclick="switchSection('overview', this)"
          >
            <span>Dashboard</span>
          </div>
          <div class="nav-item" onclick="switchSection('employees', this)">
            <span>Employees</span>
          </div>
          <div class="nav-item" onclick="switchSection('attendance', this)">
            <span>Attendance</span>
          </div>
          <div class="nav-item" onclick="switchSection('salary', this)">
            <span>Salary</span>
          </div>
          <!-- Updated Navigation Item -->
          <div class="nav-item" onclick="openEmployeeDetailsSection(this)">
            <span>Employee Details</span>
          </div>

          <div class="nav-item nav-item-logout" onclick="logout()">
            <span>Logout</span>
          </div>
        </nav>
      </aside>

      <!-- Main Content -->
      <main class="main-content">
        <!-- 1. OVERVIEW SECTION -->
        <section id="overview" class="section active">
          <div class="content-header">
            <h2>Overview</h2>
            <p>Welcome back, Administrator.</p>
          </div>

          <div class="stats-grid">
            <div class="card stat-card">
              <h3>Total Employees</h3>
              <div class="value" id="stat-total-emp">-</div>
            </div>
            <div class="card stat-card">
              <h3>Today's Date</h3>
              <div class="value" style="font-size: 1.25rem" id="stat-date">
                Loading...
              </div>
            </div>
            <div class="card stat-card">
              <h3>System Status</h3>
              <div
                class="value"
                style="color: var(--success); font-size: 1.25rem"
              >
                Online
              </div>
            </div>
          </div>
        </section>

        <!-- 2. EMPLOYEES SECTION -->
        <section id="employees" class="section">
          <div class="content-header">
            <h2>Employee Management</h2>
            <p>Add and view staff details.</p>
          </div>

          <div style="display: grid; grid-template-columns: 1fr; gap: 2rem">
            <!-- Add Form -->
            <div class="card">
              <h3>Add New Employee</h3>
              <form
                id="add-employee-form"
                onsubmit="addEmployee(event)"
                style="margin-top: 0.5rem"
              >
                <div
                  style="
                    display: grid;
                    grid-template-columns: 1fr 1fr;
                    gap: 0.75rem;
                  "
                >
                  <input
                    type="text"
                    id="emp-name"
                    class="form-control minimal-input"
                    placeholder="Full Name"
                    required
                  />
                  <input
                    type="text"
                    id="emp-role"
                    class="form-control minimal-input"
                    placeholder="Role / Designation"
                    required
                  />
                  <input
                    type="text"
                    id="emp-contact"
                    class="form-control minimal-input"
                    placeholder="Phone Number"
                    required
                  />
                  <input
                    type="text"
                    id="emp-address"
                    class="form-control minimal-input"
                    placeholder="Address"
                    required
                  />
                </div>
                <div
                  style="
                    margin-top: 0.75rem;
                    display: flex;
                    gap: 0.75rem;
                    align-items: center;
                  "
                >
                  <input
                    type="number"
                    id="emp-salary"
                    class="form-control minimal-input"
                    placeholder="Monthly Salary ($)"
                    required
                    style="flex: 1"
                  />
                  <button
                    type="submit"
                    class="btn btn-primary"
                    style="min-width: 120px; padding: 0.5rem 1rem"
                  >
                    Add
                  </button>
                </div>
              </form>
            </div>

            <!-- List Table -->
            <div class="card table-container">
              <h3>Employee Directory</h3>
              <table class="table" style="margin-top: 1rem">
                <thead>
                  <tr>
                    <th>ID</th>
                    <th>Name</th>
                    <th>Role</th>
                    <th>Phone</th>
                    <th>Address</th>
                    <th>Salary</th>
                    <th>Status</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody id="employee-table-body">
                  <!-- Populated by JS -->
                </tbody>
              </table>
            </div>
          </div>
        </section>

        <!-- 3. ATTENDANCE SECTION -->
        <section id="attendance" class="section">
          <div class="content-header">
            <h2>Attendance Tracking</h2>
            <p>Manage daily check-ins and view history.</p>
          </div>

          <div class="card">
            <div style="display: flex; gap: 1rem; align-items: flex-end">
              <div style="flex: 1; max-width: 400px">
                <label class="form-label">Select Employee</label>
                <select id="att-employee-select" class="form-control">
                  <option>Loading...</option>
                </select>
              </div>
              <button
                type="button"
                onclick="handleCheckIn()"
                class="btn btn-primary"
              >
                Check In
              </button>
              <button
                type="button"
                onclick="handleCheckOut()"
                class="btn"
                style="background: var(--bg-input); color: white"
              >
                Check Out
              </button>
            </div>
          </div>

          <div class="card table-container">
            <h3>Attendance Logs</h3>
            <table class="table" style="margin-top: 1rem">
              <thead>
                <tr>
                  <th>Date</th>
                  <th>Check In</th>
                  <th>Check Out</th>
                  <th>Worked Hours</th>
                </tr>
              </thead>
              <tbody id="attendance-table-body">
                <tr>
                  <td
                    colspan="4"
                    style="text-align: center; color: var(--text-muted)"
                  >
                    Select an employee to view logs
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </section>

        <!-- 4. SALARY SECTION -->
        <section id="salary" class="section">
          <div class="content-header">
            <h2>Salary Generation</h2>
            <p>Calculate monthly payouts based on attendance.</p>
          </div>

          <div class="card" style="max-width: 600px">
            <div class="form-group">
              <label class="form-label">Select Employee</label>
              <select id="salary-employee-select" class="form-control">
                <option>Loading...</option>
              </select>
            </div>
            <div class="form-group">
              <label class="form-label">Select Month</label>
              <input type="month" id="salary-month" class="form-control" />
            </div>

            <div style="display: flex; gap: 1rem; margin-top: 1.5rem">
              <button
                type="button"
                onclick="generateSalary()"
                class="btn btn-primary"
                style="flex: 1"
              >
                Generate Slip
              </button>
              <button
                type="button"
                onclick="viewSalary()"
                class="btn"
                style="flex: 1; background: var(--border); color: white"
              >
                View Slip
              </button>
            </div>
          </div>

          <div id="salary-result-container" style="margin-top: 2rem">
            <!-- Result Card will appear here -->
          </div>
        </section>

        <div id="profile-list-view" class="card">
          <h3>Select Employee</h3>
          <table class="table" style="margin-top: 1rem">
            <thead>
              <tr>
                <th>ID</th>
                <th>Name</th>
                <th>Role</th>
                <th>Action</th>
              </tr>
            </thead>
            <tbody id="profile-employee-list-body">
              <tr>
                <td colspan="4" style="text-align: center">Loading...</td>
              </tr>
            </tbody>
          </table>
        </div>

        <!-- 5. EMPLOYEE PROFILE SECTION (New) -->
        <div id="profile-detail-view" style="display: none">
          <button
            onclick="backToEmployeeList()"
            class="btn"
            style="margin-bottom: 1rem"
          >
            ‚Üê Back
          </button>
        </div>
        <section id="employee-profile" class="section">
          <div class="content-header">
            <h2>Employee Profile</h2>
            <p>Manage personal details and documents.</p>
          </div>

          <!-- Employee Header Card -->
          <div class="card">
            <h3>Employee Details</h3>
            <div
              style="
                display: grid;
                grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
                gap: 1.5rem;
                margin-top: 1rem;
              "
            >
              <div>
                <label class="form-label">Employee ID</label>
                <div
                  id="profile-employee-id"
                  class="value"
                  style="color: var(--text-main); font-weight: bold"
                >
                  -
                </div>
              </div>
              <div>
                <label class="form-label">Full Name</label>
                <div
                  id="profile-name"
                  class="value"
                  style="color: var(--text-main)"
                >
                  -
                </div>
              </div>
              <div>
                <label class="form-label">Role</label>
                <div
                  id="profile-role"
                  class="value"
                  style="color: var(--text-main)"
                >
                  -
                </div>
              </div>
              <div>
                <label class="form-label">Phone Number</label>
                <div
                  id="profile-phone"
                  class="value"
                  style="color: var(--text-main)"
                >
                  -
                </div>
              </div>
              <div>
                <label class="form-label">Address</label>
                <div
                  id="profile-address"
                  class="value"
                  style="color: var(--text-main)"
                >
                  -
                </div>
              </div>
              <div>
                <label class="form-label">Status</label>
                <div>
                  <span id="profile-status" class="status-badge">Active</span>
                </div>
              </div>
            </div>
          </div>

          <!-- Documents Management Card -->
          <div class="card">
            <h3>Documents Management</h3>

            <!-- Upload Form -->
            <div
              style="
                margin-top: 1rem;
                padding-bottom: 1.5rem;
                border-bottom: 1px solid var(--border);
              "
            >
              <h4
                style="
                  font-size: 0.95rem;
                  color: var(--text-muted);
                  margin-bottom: 1rem;
                "
              >
                Upload New Document
              </h4>
              <form
                style="
                  display: grid;
                  grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
                  gap: 1rem;
                  align-items: end;
                "
              >
                <div>
                  <label class="form-label">Document Type</label>
                  <select id="doc-type" class="form-control">
                    <option value="Aadhaar">Aadhaar Card</option>
                    <option value="PAN">PAN Card</option>
                    <option value="Lab ID">Lab ID</option>
                    <option value="Other">Other</option>
                  </select>
                </div>
                <div>
                  <label class="form-label">Aadhaar Number</label>
                  <input
                    type="text"
                    id="doc-aadhaar"
                    class="form-control"
                    placeholder="Enter Aadhaar No."
                  />
                </div>
                <div>
                  <label class="form-label">Select File</label>
                  <input
                    type="file"
                    id="doc-file"
                    class="form-control"
                    style="padding: 0.5rem"
                  />
                </div>
                <div>
                  <button
                    type="button"
                    id="upload-doc-btn"
                    class="btn btn-primary btn-block"
                  >
                    Upload
                  </button>
                </div>
              </form>
            </div>

            <!-- Documents Table -->
            <div class="table-container" style="margin-top: 1.5rem">
              <table class="table">
                <thead>
                  <tr>
                    <th>Document Type</th>
                    <th>Aadhaar Number</th>
                    <th>File Name</th>
                    <th>Uploaded At</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody id="employee-docs-body">
                  <tr>
                    <td
                      colspan="5"
                      style="text-align: center; color: var(--text-muted)"
                    >
                      No documents uploaded yet.
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </section>
      </main>
    </div>

    <!-- Javascript Modules -->
    <script src="js/config.js"></script>
    <script src="js/auth.js"></script>
    <script src="js/employees.js"></script>
    <script src="js/attendance.js"></script>
    <script src="js/salary.js"></script>
    <script src="js/employee_profile.js"></script>

    <!-- Inline Dashboard Control -->
    <script>
      // Set today's date in Overview
      document.getElementById("stat-date").innerText =
        new Date().toLocaleDateString();

      // Section Switching Logic
      function switchSection(sectionId, navElement) {
        // Hide all sections
        document
          .querySelectorAll(".section")
          .forEach((el) => el.classList.remove("active"));
        // Show target section
        document.getElementById(sectionId).classList.add("active");

        // Update Sidebar Active State
        document
          .querySelectorAll(".nav-item")
          .forEach((el) => el.classList.remove("active"));
        if (navElement) navElement.classList.add("active");
      }

      // Initial Load
      function init() {
        // Check if we need to update totals in UI helper
        window.updateDashboardStats = function (count) {
          document.getElementById("stat-total-emp").innerText = count;
        };
        // Start fetching data
        loadEmployees();
      }

      init();
    </script>
  </body>
</html>
